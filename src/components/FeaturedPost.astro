---
import Card from './Card.astro';

const { withTitle } = Astro.props;
let allPosts = await Astro.glob('../data/blog-posts/*.md');
allPosts = allPosts.sort((a, b) => new Date(b.frontmatter.publishDate).valueOf() - new Date(a.frontmatter.publishDate).valueOf());
const featuredPost = allPosts.find(post => post.frontmatter.featured);
const featuredImage = (featuredPost.frontmatter.socialImage !== undefined) ? featuredPost.frontmatter.socialImage : 'assets/social.jpg';
const socialImageAlt = (featuredPost.frontmatter.socialImageAlt !== undefined) ? featuredPost.frontmatter.socialImageAlt : `alt text is missing for ${featuredPost.frontmatter.title} social image. Please let me know.`;

---

{ featuredPost &&
  <>
    {withTitle && <h2>Featured</h2>}
    <Card>
      <figure>
        <img src={`/${featuredImage}`} alt={socialImageAlt} />
      </figure>
      <div class="post-item">
        <h3>
          <a href={`/blog/${featuredPost.file.split('/').pop().split('.').shift()}`}>{featuredPost.frontmatter.title}</a>
        </h3>
        <p>{featuredPost.frontmatter.description}</p>
        <div class="post-item-footer">
          <span class="post-item-date">â€” {featuredPost.frontmatter.publishDate}</span>
        </div>
      </div>
    </Card>
  </>
}

<style>
  h2 {
    margin-bottom: 1.2em !important;
  }
</style>